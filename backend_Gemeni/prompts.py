def create_linear_prompt(cards):
    positions = ["Прошлое", "Настоящее", "Будущее"]
    
    prompt = """Ты — таролог. Выбран расклад «Три карты» (структура: прошлое → настоящее → будущее).

Карты:
"""
    
    for i, card in enumerate(cards[:3]):
        suit = card.get('suit', 'Старший Аркан' if card['type'] == 'major' else 'Не указана')
        meaning = card['meaning_rev'] if card.get('reversed', False) else card['meaning_up']
        orientation = "перевернутая" if card.get('reversed', False) else "прямая"
        
        prompt += f"""{positions[i]}:
Название: {card['name']}
Масть: {suit}
Тип: {card['type']}
Позиция: {orientation}
Значение: {meaning}

"""
    
    prompt += """Сгенерируй ответ по плану:
1. Кратко интерпретируй каждую карту в её позиции (прошлое/настоящее/будущее), опираясь на значение и контекст запроса.
2. Опиши, как карты связаны между собой: какие причины из прошлого влияют на настоящее, как настоящее формирует будущее.
3. Дай итоговый вывод: что этот расклад говорит о ситуации? Какие тенденции видны? Чего стоит ожидать или к чему подготовиться?

Требования к ответу:
- Стиль: спокойный, поддерживающий, без категоричных предсказаний.
- В конце добавь мягкую рекомендацию: «На основе этого расклада может быть полезно…»"""
    
    return prompt


def create_advice_prompt(cards):
    positions = ["Вариант А", "Вариант Б", "Итог"]
    
    prompt = """Ты — таролог. Выбран расклад «Выбор» (структура: вариант А → вариант Б → итог).

Карты:
"""
    
    for i, card in enumerate(cards[:3]):
        suit = card.get('suit', 'Старший Аркан' if card['type'] == 'major' else 'Не указана')
        meaning = card['meaning_rev'] if card.get('reversed', False) else card['meaning_up']
        orientation = "перевернутая" if card.get('reversed', False) else "прямая"
        
        prompt += f"""{positions[i]}:
Название: {card['name']}
Масть: {suit}
Тип: {card['type']}
Позиция: {orientation}
Значение: {meaning}

"""
    
    prompt += """Сгенерируй ответ по плану:
1. Интерпретируй каждую карту в её позиции: что она говорит о варианте А, варианте Б и вероятном итоге?
2. Сравни варианты: какие возможности и риски видит Таро в каждом? Как третья карта уточняет или уравновешивает первые две?
3. Сформулируй вывод: какой путь может быть более благоприятным? Что стоит учесть перед решением?

Требования к ответу:
- Стиль: нейтральный, без навязывания выбора. Подчеркни, что это символическая подсказка."""
    
    return prompt


def create_balance_prompt(cards):
    positions = ["Причина", "Препятствие", "Решение"]
    
    prompt = """Ты — таролог. Выбран расклад «Суть ситуации» (структура: причина → препятствие → решение).

Карты:
"""
    
    for i, card in enumerate(cards[:3]):
        suit = card.get('suit', 'Старший Аркан' if card['type'] == 'major' else 'Не указана')
        meaning = card['meaning_rev'] if card.get('reversed', False) else card['meaning_up']
        orientation = "перевернутая" if card.get('reversed', False) else "прямая"
        
        prompt += f"""{positions[i]}:
Название: {card['name']}
Масть: {suit}
Тип: {card['type']}
Позиция: {orientation}
Значение: {meaning}

"""
    
    prompt += """Сгенерируй ответ по плану:
1. Объясни каждую карту в её роли: что стало причиной ситуации? Какое препятствие мешает? Какое решение предлагает Таро?
2. Покажи взаимосвязь: как причина породила препятствие, и как решение может его преодолеть?
3. Сформулируй вывод: какой шаг или внутренний настрой сейчас наиболее важен? Чего стоит избегать?

Требования к ответу:
- Стиль: поддерживающий, с акцентом на возможности. Избегай фатализма."""
    
    return prompt
